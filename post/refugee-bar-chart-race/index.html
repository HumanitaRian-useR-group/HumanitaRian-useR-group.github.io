<!DOCTYPE HTML>

<html>
    <head>
        
            
                <title>Bar Chart Race for Refugees</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.74.3" />
        


        
            <meta name="author" content="Edouard Legoupil">
        
        
            
                <meta name="description" content="The humanitarian data analysis professional community shall work towards using a common and open language to build interoperable and transparent analysis standards for joint needs assessments and to obtain maximum value for any data collected.">
            
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Bar Chart Race for Refugees"/>
<meta name="twitter:description" content="“Bar Chart Race” are a specific type of bar chart that moves to show rankings over time. It became recently a quite popular approach to bring a storytelling elements within a longitudinal dataset. Readers are suggested to connect and combine what they see on the chart with other qualitive elements that they know about (elements of history). By using the allegory of F1 Race, it gives a very dynamic dimension."/>

        <meta property="og:title" content="Bar Chart Race for Refugees" />
<meta property="og:description" content="“Bar Chart Race” are a specific type of bar chart that moves to show rankings over time. It became recently a quite popular approach to bring a storytelling elements within a longitudinal dataset. Readers are suggested to connect and combine what they see on the chart with other qualitive elements that they know about (elements of history). By using the allegory of F1 Race, it gives a very dynamic dimension." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/refugee-bar-chart-race/" />
<meta property="article:published_time" content="2019-03-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-03-24T00:00:00+00:00" />

        <meta property="og:image" content="//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        <meta itemprop="name" content="Bar Chart Race for Refugees">
<meta itemprop="description" content="“Bar Chart Race” are a specific type of bar chart that moves to show rankings over time. It became recently a quite popular approach to bring a storytelling elements within a longitudinal dataset. Readers are suggested to connect and combine what they see on the chart with other qualitive elements that they know about (elements of history). By using the allegory of F1 Race, it gives a very dynamic dimension.">
<meta itemprop="datePublished" content="2019-03-24T00:00:00+00:00" />
<meta itemprop="dateModified" content="2019-03-24T00:00:00+00:00" />
<meta itemprop="wordCount" content="1750">



<meta itemprop="keywords" content="UNHCR,Edouard-Legoupil," />

        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="/css/main.css">
            <link rel="stylesheet" href="/css/add-on.css">
            <link rel="stylesheet" href="/css/academicons.min.css">
        

        
            
                
            
        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />
  


      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-131350181-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

      
            <script
			  src="http://code.jquery.com/jquery-3.3.1.min.js"
			  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
			  crossorigin="anonymous"></script>
			  
    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      
        <h1><a href="/">post</a></h1>
      
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/post/index.html">
                            <i class="fa fa-home">&nbsp;</i>Home
                    </a>
                </li>
            
                <li>
                    <a href="/about/">
                            <i class="fa fa-info-circle">&nbsp;</i>About
                    </a>
                </li>
            
                <li>
                    <a href="/tags/">
                            <i class="fa fa-newspaper-o">&nbsp;</i>Contributors
                    </a>
                </li>
            
                <li>
                    <a href="/categories/">
                            <i class="fa fa-database">&nbsp;</i>Categories
                    </a>
                </li>
            
                <li>
                    <a href="https://join.skype.com/qYBKC5q3wKp4">
                            <i class="fa fa-phone">&nbsp;</i>Join the Skype-group
                    </a>
                </li>
            
                <li>
                    <a href="https://www.r-bloggers.com/">
                            <i class="fa fa-universal-access">&nbsp;</i>learn more with R-bloggers
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/post/index.html">
                            <h3>
                                <i class="fa fa-home">&nbsp;</i>Home
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/about/">
                            <h3>
                                <i class="fa fa-info-circle">&nbsp;</i>About
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags/">
                            <h3>
                                <i class="fa fa-newspaper-o">&nbsp;</i>Contributors
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories/">
                            <h3>
                                <i class="fa fa-database">&nbsp;</i>Categories
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://join.skype.com/qYBKC5q3wKp4">
                            <h3>
                                <i class="fa fa-phone">&nbsp;</i>Join the Skype-group
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://www.r-bloggers.com/">
                            <h3>
                                <i class="fa fa-universal-access">&nbsp;</i>learn more with R-bloggers
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section class="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/anonymisation/">Anonymisation: Intrusion scenario and risk threshold</a></h3>
                                
                                <time class="published" datetime=
                                    '2020-06-25'>
                                    June 25, 2020</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/">Post</a></h3>
                                
                                <time class="published" datetime=
                                    '2020-06-25'>
                                    June 25, 2020</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/tidysampling/">Working with Survey Samples in the Tidyverse</a></h3>
                                
                                <time class="published" datetime=
                                    '2020-05-29'>
                                    May 29, 2020</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/geosampling/">Using Gridded Population Data for Household Survey Sampling</a></h3>
                                
                                <time class="published" datetime=
                                    '2020-04-14'>
                                    April 14, 2020</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/quick-tips-for-visualising-data/">Quick tips for visualising data (with R)</a></h3>
                                
                                <time class="published" datetime=
                                    '2020-04-02'>
                                    April 2, 2020</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/conjoint-analysis/">Conjoint analysis: modeling judgement to calibrate vulnerability scoring</a></h3>
                                
                                <time class="published" datetime=
                                    '2020-03-19'>
                                    March 19, 2020</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/analytic-hierachy-process/">Using Analytic Hierarchy Process to weight vulnerability scorecard</a></h3>
                                
                                <time class="published" datetime=
                                    '2020-02-23'>
                                    February 23, 2020</time>
                            </header>
                            

                        </article>
                

                
                    <a href=
                        
                            /post/
                        
                        class="button">See more</a>
                
            </div>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            



<li>
  <a href="//twitter.com/share?url=%2fpost%2frefugee-bar-chart-race%2f&amp;text=Bar%20Chart%20Race%20for%20Refugees&amp;via=" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>




<li>
  <a href="//plus.google.com/share?url=%2fpost%2frefugee-bar-chart-race%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>





<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=%2fpost%2frefugee-bar-chart-race%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>




<li>
  <a href="//reddit.com/submit?url=%2fpost%2frefugee-bar-chart-race%2f&amp;title=Bar%20Chart%20Race%20for%20Refugees" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>




<li>
  <a href="//www.linkedin.com/shareArticle?url=%2fpost%2frefugee-bar-chart-race%2f&amp;title=Bar%20Chart%20Race%20for%20Refugees" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>




<li>
  <a href="//www.stumbleupon.com/submit?url=%2fpost%2frefugee-bar-chart-race%2f&amp;title=Bar%20Chart%20Race%20for%20Refugees" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>




<li>
  <a href="//www.pinterest.com/pin/create/button/?url=%2fpost%2frefugee-bar-chart-race%2f&amp;description=Bar%20Chart%20Race%20for%20Refugees" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>




<li>
  <a href="mailto:?subject=Check out this post by Edouard%20Legoupil&amp;body=%2fpost%2frefugee-bar-chart-race%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>


        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
  <header>
    <div class="title">
        
            <h1><a href="/post/refugee-bar-chart-race/">Bar Chart Race for Refugees</a></h1>
            
        
        
    </div>
    <div class="meta">
        <time class="published"
            datetime='2019-03-24 00:00:00 &#43;0000 UTC'>
            March 24, 2019</time>
        <span class="author">Edouard Legoupil</span>
        
            <p>9 minutes read</p>
        
    </div>
</header>


  

  

  
  <div>
     
 <div id="go-to-folding-div" style="display: inline-block;vertical-align: top;height: 1px;margin-top: -4em;"></div>
 <div id="code-folding-buttons" class="btn-group pull-right">
   <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast="">
     <span>Show/Hide all code</span> 
     <span class="caret"></span>
   </button>
   <ul class="dropdown-menu" style="min-width: 50px;">
   <li><a id="rmd-show-all-code" href="#go-to-folding-div">Show All Code</a>
   </li><li><a id="rmd-hide-all-code" href="#go-to-folding-div">Hide All Code</a></li>
   </ul>
 </div>
 

    <br/>
    <div id="content" class="article-entry">
      


<p>“Bar Chart Race” are a specific type of bar chart that moves to show rankings over time. It became recently a quite popular approach to bring a storytelling elements within a longitudinal dataset. Readers are suggested to connect and combine what they see on the chart with other qualitive elements that they know about (elements of history). By using the allegory of F1 Race, it gives a very dynamic dimension.</p>
<!--MORE-->
<p>You can check below a series of Viz on different issues:</p>
<ul>
<li>10 most populous cities in the world from 1500-2018:</li>
</ul>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
10 most populous cities in the world from 1500-2018. <a href="https://twitter.com/hashtag/dataviz?src=hash&amp;ref_src=twsrc%5Etfw">#dataviz</a><a href="https://t.co/vtGEBVLdYk">https://t.co/vtGEBVLdYk</a> <a href="https://t.co/uvIkuE4VDI">pic.twitter.com/uvIkuE4VDI</a>
</p>
— Randy Olson (<span class="citation">@randal_olson</span>) <a href="https://twitter.com/randal_olson/status/1108031293143556097?ref_src=twsrc%5Etfw">March 19, 2019</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<ul>
<li>10 largest CO2 emitter</li>
</ul>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
<strong>Bar Chart Race for CO2</strong><br><br>The changing ranks of the 10 largest CO2 emitters in the world since 1850.<br><br>Fascinating to see nations rise, fall &amp; rise again in their yearly emissions*<br><br>See how the UK dominates the C19th &amp; US the 20th.<br><br>Then watch China surge ahead after 2005… <a href="https://t.co/mFLuHB8kTw">pic.twitter.com/mFLuHB8kTw</a>
</p>
— Simon Evans (<span class="citation">@DrSimEvans</span>) <a href="https://twitter.com/DrSimEvans/status/1108745504400334849?ref_src=twsrc%5Etfw">March 21, 2019</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<ul>
<li>10 most expensive cities</li>
</ul>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
Very impressed by the ‘bar chart race’ template from <a href="https://twitter.com/f_l_o_u_r_i_s_h?ref_src=twsrc%5Etfw"><span class="citation">@f_l_o_u_r_i_s_h</span></a>. It doesn't have <a href="https://twitter.com/jburnmurdoch?ref_src=twsrc%5Etfw"><span class="citation">@jburnmurdoch</span></a>'s awesome multipurpose map, but the legend toggle is a lovely touch (1/3) <a href="https://t.co/RbjxTC7V5W">pic.twitter.com/RbjxTC7V5W</a>
</p>
— Alex Selby-Boothroyd (<span class="citation">@AlexSelbyB</span>) <a href="https://twitter.com/AlexSelbyB/status/1109239212455460869?ref_src=twsrc%5Etfw">March 22, 2019</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>With R, it’s fairly easy to reproduce such vis - We will show here how to use <code>gganimate</code> R packages to display evolution of refugees &amp; IDP’s number over time based on UNHCR statistics</p>
<pre class="r"><code>## Getting all necessary package

using &lt;- function(...) {
    libs &lt;- unlist(list(...))
    req &lt;- unlist(lapply(libs,require,character.only = TRUE))
    need &lt;- libs[req == FALSE]
    if (length(need) &gt; 0) { 
        install.packages(need)
        lapply(need,require,character.only = TRUE)
    }
}


using(&quot;tidyverse&quot;,&quot;gganimate&quot;,&quot;gghighlight&quot;,&quot;ggpubr&quot;)</code></pre>
<pre class="r"><code>## loading libraries plus functions

library(tidyverse)
library(gganimate)
library(gghighlight)
library(ggpubr)


## a little help function to better format number
format_si &lt;- function(...) {
  function(x) {
    limits &lt;- c(1e-24, 1e-21, 1e-18, 1e-15, 1e-12,
                1e-9,  1e-6,  1e-3,  1e0,   1e3,
                1e6,   1e9,   1e12,  1e15,  1e18,
                1e21,  1e24)
    prefix &lt;- c(&quot;y&quot;,   &quot;z&quot;,   &quot;a&quot;,   &quot;f&quot;,   &quot;p&quot;,
                &quot;n&quot;,   &quot;&quot;,   &quot;m&quot;,   &quot; &quot;,   &quot;k&quot;,
                &quot;M&quot;,   &quot;G&quot;,   &quot;T&quot;,   &quot;P&quot;,   &quot;E&quot;,
                &quot;Z&quot;,   &quot;Y&quot;)

    # Vector with array indices according to position in intervals
    i &lt;- findInterval(abs(x), limits)

    # Set prefix to &quot; &quot; for very small values &lt; 1e-24
    i &lt;- ifelse(i == 0, which(limits == 1e0), i)

    paste(format(round(x/limits[i], 1),
                 trim = TRUE, scientific = FALSE, ...),
          prefix[i])
  }
}</code></pre>
<p>Let’s now download the data from UNHCR popstat API</p>
<pre class="r"><code># Time series
#url &lt;- paste( &#39;http://popstats.unhcr.org/en/time_series.csv&#39;) 
#download.file(url, destfile = &quot;unhcr_popstats_export_time_series_all_data.csv&quot; )</code></pre>
<p>Reshape the data to get the top 10 for each year using tidyverse</p>
<pre class="r"><code>time_series &lt;- read.csv(&quot;unhcr_popstats_export_time_series_all_data.csv&quot;, skip = 3) 
## rename the country and make sure Value is a number...
names(time_series)[2] &lt;- &quot;Country&quot;

## make sure Value is numeric
time_series$Value &lt;- as.integer(as.character(time_series$Value))

## Check what population type we have there and subset accordingly
#levels(time_series$Population.type)

time_series2 &lt;- time_series[ time_series$Population.type %in% c(&quot;Refugees (incl. refugee-like situations)&quot;, &quot;Internally displaced persons&quot; ), ]

time_series2$Country &lt;- as.character(time_series2$Country)
time_series2$Country[time_series2$Country == &quot;C\xf4te d&#39;Ivoire&quot;] &lt;- &quot;Cote d&#39;Ivoire&quot; 
time_series2$Country &lt;- as.factor(time_series2$Country)

time_series$Population.type &lt;- as.factor(as.character(time_series$Population.type))

## Remove unknow countries or blanks
time_series2 &lt;- time_series2[ !(time_series2$Country %in% c(&quot;Various/Unknown&quot; )), ]

## Remove if value is 0 or NA
time_series2 &lt;- time_series2[ !(is.na(time_series2$Value)), ]
time_series2 &lt;- time_series2[ time_series2$Value != 0, ]

## Now get the rank from high to low for all countries per  year and population type
rank_data &lt;- time_series2 %&gt;%
  group_by(Year, Population.type, Country) %&gt;%
  summarise(Value2 = sum(Value) ) 


#str(as.data.frame(rank_data))
rank_data &lt;- as.data.frame(rank_data)

rank_data2 &lt;- rank_data %&gt;%
  group_by(Year, Population.type) %&gt;%
  
  ## Tried first rank but did not provided ranks as integer... 
  # mutate(ordering = rank(-Value), ties.method = &quot;min&quot;) %&gt;%
  
  mutate(ordering = rank(-Value2)) %&gt;%
  ungroup() 

## check our value for rank -- Note that there are different tie method
#levels(as.factor(rank_data$ordering))

## need to fix manually issue when ex-aequo rank rank = 8.5 

## In 1962
rank_data2$ordering[rank_data2$ordering == 10 &amp;
                      rank_data2$Year == &quot;1962&quot; &amp;
                      rank_data2$Population.type %in% c(&quot;Refugees (incl. refugee-like situations)&quot;)] &lt;- 11

rank_data2$ordering[rank_data2$ordering == 8.5 &amp;
                      rank_data2$Year == &quot;1962&quot; &amp;
                      rank_data2$Country == &quot;Burundi&quot; &amp;
                      rank_data2$Population.type %in% c(&quot;Refugees (incl. refugee-like situations)&quot;)] &lt;- 9

rank_data2$ordering[rank_data2$ordering == 8.5 &amp;
                      rank_data2$Year == &quot;1962&quot; &amp;
                      rank_data2$Country == &quot;Austria&quot; &amp;
                      rank_data2$Population.type %in% c(&quot;Refugees (incl. refugee-like situations)&quot;)] &lt;- 10


## In 1978
rank_data2$ordering[rank_data2$ordering == 10 &amp;
                      rank_data2$Year == &quot;1978&quot; &amp;
                      rank_data2$Population.type %in% c(&quot;Refugees (incl. refugee-like situations)&quot;)] &lt;- 11

rank_data2$ordering[rank_data2$ordering == 8.5 &amp;
                      rank_data2$Year == &quot;1978&quot; &amp;
                      rank_data2$Country == &quot;Viet Nam&quot; &amp;
                      rank_data2$Population.type %in% c(&quot;Refugees (incl. refugee-like situations)&quot;)] &lt;- 9

rank_data2$ordering[rank_data2$ordering == 8.5 &amp;
                      rank_data2$Year == &quot;1978&quot; &amp;
                      rank_data2$Country == &quot;United Kingdom&quot; &amp; 
                      rank_data2$Population.type %in% c(&quot;Refugees (incl. refugee-like situations)&quot;)] &lt;- 10


## and for IPDs

rank_data2$Country &lt;- as.character(rank_data2$Country)

## In 1996
rank_data2$ordering[rank_data2$ordering == 10 &amp;
                      rank_data2$Year == &quot;1996&quot; &amp;
                      rank_data2$Population.type %in% c(&quot;Internally displaced persons&quot;)] &lt;- 11

rank_data2$ordering[rank_data2$ordering == 9.5 &amp;
                      rank_data2$Year == &quot;1996&quot; &amp;
                      rank_data2$Country == &quot;Somalia&quot; &amp;
                      rank_data2$Population.type %in% c(&quot;Internally displaced persons&quot;)] &lt;- 11


rank_data2$Country[rank_data2$ordering == 9.5 &amp;
                      rank_data2$Year == &quot;1996&quot; &amp;
                      rank_data2$Country == &quot;Sri Lanka&quot; &amp; 
                      rank_data2$Population.type %in% c(&quot;Internally displaced persons&quot;)] &lt;- &quot;Sri Lanka / Somalia&quot;

rank_data2$ordering[rank_data2$ordering == 9.5 &amp;
                      rank_data2$Year == &quot;1996&quot; &amp;
                      rank_data2$Country == &quot;Sri Lanka / Somalia&quot; &amp; 
                      rank_data2$Population.type %in% c(&quot;Internally displaced persons&quot;)] &lt;- 10

## in 1997
rank_data2$ordering[rank_data2$ordering == 10 &amp;
                      rank_data2$Year == &quot;1997&quot; &amp;
                      rank_data2$Population.type %in% c(&quot;Internally displaced persons&quot;)] &lt;- 11

rank_data2$ordering[rank_data2$ordering == 9.5 &amp;
                      rank_data2$Year == &quot;1997&quot; &amp;
                      rank_data2$Country == &quot;Somalia&quot; &amp;
                      rank_data2$Population.type %in% c(&quot;Internally displaced persons&quot;)] &lt;- 11


rank_data2$Country[rank_data2$ordering == 9.5 &amp;
                      rank_data2$Year == &quot;1997&quot; &amp;
                      rank_data2$Country == &quot;Sri Lanka&quot; &amp; 
                      rank_data2$Population.type %in% c(&quot;Internally displaced persons&quot;)] &lt;- &quot;Sri Lanka / Somalia&quot;

rank_data2$ordering[rank_data2$ordering == 9.5 &amp;
                      rank_data2$Year == &quot;1997&quot; &amp;
                      rank_data2$Country == &quot;Sri Lanka / Somalia&quot; &amp; 
                      rank_data2$Population.type %in% c(&quot;Internally displaced persons&quot;)] &lt;- 10


rank_data2$Country &lt;- as.factor(rank_data2$Country)

# Filter only top 10 
rank_data2 &lt;- rank_data2[rank_data2$ordering &lt;= 10, ]
#rank_data$Year = as.Date(as.character(rank_data$Year), format = &quot;%Y&quot;)


## Regnerate facors modality - 
rank_data2$Country &lt;- as.factor(as.character(rank_data2$Country))
# levels(as.factor(rank_data2$Country))
## Double checking country name
#table(time_series2$Country, useNA = &quot;ifany&quot;)</code></pre>
<p>and now visualise</p>
<pre class="r"><code>ggplot(rank_data2[ rank_data2$Year == 1951 &amp; rank_data2$Population.type %in% c(&quot;Refugees (incl. refugee-like situations)&quot;), ]) +
  geom_bar(aes(y = Value2,  x =   reorder(ordering, desc(ordering)),
               group = Country ,color = Country, fill = Country), alpha = 0.75, stat = &quot;identity&quot;) +
  
  geom_label(aes(y = 0 , x =  reorder(ordering, desc(ordering)), label = Country),
             hjust = 0,
             vjust = 0.5,
             fill = NA,
             label.size = NA,
             family = &quot;Helvetica&quot;,
             size = 6) +

  coord_flip(clip = &quot;off&quot;, expand = FALSE) +
  scale_color_viridis_d(option = &quot;plasma&quot; ) +
  scale_fill_viridis_d(option = &quot;plasma&quot;) +
  scale_y_continuous(labels = format_si()) +
  theme_minimal(14, &quot;Avenir&quot;) +
  
  guides(color = F, fill = F) +
  labs(title =  &quot;Top 10 Hosting Countries&quot;,
       subtitle = &#39;Year 1951&#39;,
       y = &quot;Population Size&quot;,
       x = &quot;&quot;,
       caption =  &quot;Source: UNHCR Population Statistics -http://popstats.unhcr.org &quot;) +
  theme(plot.title = element_text(hjust = 1, size = 22),
        axis.ticks.y = element_blank(),
        axis.text.y  = element_blank(), 
        panel.background  = element_blank(), 
        panel.grid = element_blank(),
        plot.background = element_blank(),
        legend.position = &quot;bottom&quot;,
        panel.grid.major.x = element_line(color = &quot;#cbcbcb&quot;), 
        panel.grid.major.y = element_blank()) </code></pre>
<p><img src="/post/refugee-bar-chart-race_files/figure-html/chart1951-1.png" width="672" /></p>
<p>Faceting by Population Group for 2017</p>
<pre class="r"><code>ggplot(rank_data2[ rank_data2$Year == 2017, ]) +
  geom_bar(aes(y = Value2,  x =   reorder(ordering, desc(ordering)),
               group = Country ,color = Country, fill = Country), alpha = 0.75, stat = &quot;identity&quot;) +
  
  geom_label(aes(y = 0 , x =  reorder(ordering, desc(ordering)), label = Country),
             hjust = 0,
             vjust = 0.5,
             fill = NA,
             label.size = NA,
             family = &quot;Helvetica&quot;,
             size = 6) +
  
  #facet_wrap( ~ Population.type) +
  facet_grid(. ~ Population.type) +
  coord_flip(clip = &quot;off&quot;, expand = FALSE) +
  scale_color_viridis_d(option = &quot;plasma&quot; ) +
  scale_fill_viridis_d(option = &quot;plasma&quot;) +
  scale_y_continuous(labels = format_si()) +
  theme_minimal(14, &quot;Avenir&quot;) +
  
  guides(color = F, fill = F) +
  labs(title =  &quot;Top 10 Countries&quot;,
       subtitle = &#39;Year 2017&#39;,
       y = &quot;Population Size&quot;,
       x = &quot;&quot;,
       caption =  &quot;Source: UNHCR Population Statistics -http://popstats.unhcr.org &quot;) +
  theme(plot.title = element_text(hjust = 1, size = 22),
        axis.ticks.y = element_blank(),
        axis.text.y  = element_blank(), 
        panel.background  = element_blank(), 
        panel.grid = element_blank(),
        plot.background = element_blank(),
        legend.position = &quot;bottom&quot;,
        panel.grid.major.x = element_line(color = &quot;#cbcbcb&quot;), 
        panel.grid.major.y = element_blank()) </code></pre>
<p><img src="/post/refugee-bar-chart-race_files/figure-html/chart2017facet-1.png" width="672" /></p>
<p>and animate…. the bar chart race…</p>
<pre class="r"><code>p &lt;- ggplot(rank_data2[rank_data2$Population.type %in% c(&quot;Refugees (incl. refugee-like situations)&quot;), ]) +
  geom_bar(aes(y = Value2,  x =   reorder(ordering, desc(ordering)),
               group = Country ,color = Country, fill = Country), alpha = 0.75, stat = &quot;identity&quot;) +
  
  geom_label(aes(y = 0 , x =  reorder(ordering, desc(ordering)), label = Country),
             hjust = 0,
             vjust = 0.5,
             fill = NA,
             label.size = NA,
             family = &quot;Helvetica&quot;,
             size = 6) +
  
  coord_flip(clip = &quot;off&quot;, expand = FALSE) +
  scale_color_viridis_d(option = &quot;plasma&quot; ) +
  scale_fill_viridis_d(option = &quot;plasma&quot;) +
  scale_y_continuous(labels = format_si()) +
  theme_minimal(14, &quot;Avenir&quot;) +
  #facet_wrap( ~ Population.type) +
  #facet_grid(. ~ Population.type) +
  
  ## get the animation per year... #, nframes = 250, fps = 10, end_pause = 20
  transition_time(Year ) +
  ease_aes(&#39;cubic-in-out&#39;) + 
 # enter_fade() +
 # exit_fade() +
  #view_follow(fixed_y = TRUE) +
  
  guides(color = F, fill = F) +
  labs(title =  &quot;Top 10 Hosting Countries, 1951 - 2017&quot;,
       subtitle = &#39;Year {frame_time}&#39;,
       y = &quot;Population Size&quot;,
       x = &quot;&quot;,
       caption =  &quot;Source: UNHCR Population Statistics -http://popstats.unhcr.org &quot;) +
  theme(plot.title = element_text(hjust = 1, size = 22),
        axis.ticks.y = element_blank(),
        axis.text.y  = element_blank(), 
        panel.background  = element_blank(), 
        panel.grid = element_blank(),
        plot.background = element_blank(),
        legend.position = &quot;bottom&quot;,
        panel.grid.major.x = element_line(color = &quot;#cbcbcb&quot;), 
        panel.grid.major.y = element_blank()) 

#animate(p, nframes = 250, fps = 4, end_pause = 20, width = 600)
animate(p, fps = 1, nframes = 250, end_pause = 20, width = 600)</code></pre>
<p><img src="/post/refugee-bar-chart-race_files/figure-html/barchartrace%20-1.gif" /><!-- --></p>
<pre class="r"><code>anim_save(&quot;bar_chart_race_refugee.gif&quot;, animate(p, fps = 1, nframes = 250, end_pause = 20, width = 600))</code></pre>
<p>the same bar chart race but for IDPs..</p>
<pre class="r"><code>p &lt;- ggplot(rank_data2[rank_data2$Population.type %in% c(&quot;Internally displaced persons&quot;), ]) +
  geom_bar(aes(y = Value2,  x =   reorder(ordering, desc(ordering)),
               group = Country ,color = Country, fill = Country), alpha = 0.75, stat = &quot;identity&quot;) +
  
  geom_label(aes(y = 0 , x =  reorder(ordering, desc(ordering)), label = Country),
             hjust = 0,
             vjust = 0.5,
             fill = NA,
             label.size = NA,
             family = &quot;Helvetica&quot;,
             size = 6) +
  
  coord_flip(clip = &quot;off&quot;, expand = FALSE) +
  scale_color_viridis_d(option = &quot;plasma&quot; ) +
  scale_fill_viridis_d(option = &quot;plasma&quot;) +
  scale_y_continuous(labels = format_si()) +
  theme_minimal(14, &quot;Avenir&quot;) +
  #facet_wrap( ~ Population.type) +
  #facet_grid(. ~ Population.type) +
  
  ## get the animation per year... #, nframes = 250, fps = 10, end_pause = 20
  transition_time(Year ) +
  ease_aes(&#39;cubic-in-out&#39;) + 
 # enter_fade() +
 # exit_fade() +
  #view_follow(fixed_y = TRUE) +
  
  guides(color = F, fill = F) +
  labs(title =  &quot;Top 10 IDPs Countries, 1993 - 2017&quot;,
       subtitle = &#39;Year {frame_time}&#39;,
       y = &quot;Population Size&quot;,
       x = &quot;&quot;,
       caption =  &quot;Source: UNHCR Population Statistics -http://popstats.unhcr.org &quot;) +
  theme(plot.title = element_text(hjust = 1, size = 22),
        axis.ticks.y = element_blank(),
        axis.text.y  = element_blank(), 
        panel.background  = element_blank(), 
        panel.grid = element_blank(),
        plot.background = element_blank(),
        legend.position = &quot;bottom&quot;,
        panel.grid.major.x = element_line(color = &quot;#cbcbcb&quot;), 
        panel.grid.major.y = element_blank()) 

#animate(p, nframes = 250, fps = 4, end_pause = 20, width = 600)
animate(p, fps = 1, nframes = 250, end_pause = 20, width = 600)</code></pre>
<p><img src="/post/refugee-bar-chart-race_files/figure-html/barchartrace2%20-1.gif" /><!-- --></p>
<pre class="r"><code>anim_save(&quot;bar_chart_race_idp.gif&quot;, animate(p, fps = 1, nframes = 250, end_pause = 20, width = 600))</code></pre>

    </div>
      

  </div>

  <footer>
    <ul class="stats">
  <li class="categories">
    <ul>
        
            
            
                <i class="fa fa-folder"></i>
                
                
                <li><a class="article-category-link" href="/categories/dataviz">DataViz</a></li>
                
                
                <li><a class="article-category-link" href="/categories/animation">Animation</a></li>
                
                
                <li><a class="article-category-link" href="/categories/refugee">Refugee</a></li>
                
                
                <li><a class="article-category-link" href="/categories/api">API</a></li>
                
            
        
    </ul>
  </li>
  <li class="tags">
    <ul>
        
            
            
                <i class="fa fa-tags"></i>
                
                
                <li><a class="article-category-link" href="/tags/unhcr">UNHCR</a></li>
                
                
                <li><a class="article-category-link" href="/tags/edouard-legoupil">Edouard-Legoupil</a></li>
                
            
        
    </ul>
  </li>
</ul>

    
 
  <script>
  $(document).ready(function () {
    window.initializeCodeFolding("show" === "hide");
  });
  </script>
  
  <script>
    window.initializeCodeFolding = function(show) {

  
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  
  var currentIndex = 1;

  
  var rCodeBlocks = $('');
  rCodeBlocks.each(function() {

    
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}

  </script>
  


  </footer>
  

<div class="related-articles">
<h3>Related articles</h3>
<ul>
	<li>
	
	  <ul>
      <article class="mini-post">
        <header>
          <h3>
            <a href="/post/refugee-population-viz/">Refugee Population Data Visualisation</a>
          </h3>
          
          <time class="published" datetime='2018-12-24 00:00:00 &#43;0000 UTC'>
          December 24, 2018</time>
        </header>
        

      </article>
  	</ul>
	
	</li>	
</ul>
</div>


</article>

    <article class="post">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-humanitarian-user-group-github-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>


<ul class="actions pagination">
    
        <li><a href="/post/sahel-fatalities/"
                class="button big previous">Fatal events in the Sahel</a></li>
    

    
        <li><a href="/post/eulerkobo/"
                class="button big next">Euler chart for multichoice questions from Kobo</a></li>
    
</ul>


    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
      
        <a href='/' class="logo"><img src="/images/avatar.png" alt="HumanitaRian useR Group" /></a>
      
    
    
      <header>
        <h2></h2>
        <p>~ Science is 'show me' - not 'trust me' ~</p>
      </header>
    
    
  </section>

  
  <section class="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/anonymisation/">Anonymisation: Intrusion scenario and risk threshold</a>
              </h3>
              
              <time class="published" datetime='2020-06-25 00:00:00 &#43;0000 UTC'>
              June 25, 2020</time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/">Post</a>
              </h3>
              
              <time class="published" datetime='2020-06-25 00:00:00 &#43;0000 UTC'>
              June 25, 2020</time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/tidysampling/">Working with Survey Samples in the Tidyverse</a>
              </h3>
              
              <time class="published" datetime='2020-05-29 00:00:00 &#43;0000 UTC'>
              May 29, 2020</time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/geosampling/">Using Gridded Population Data for Household Survey Sampling</a>
              </h3>
              
              <time class="published" datetime='2020-04-14 00:00:00 &#43;0000 UTC'>
              April 14, 2020</time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/quick-tips-for-visualising-data/">Quick tips for visualising data (with R)</a>
              </h3>
              
              <time class="published" datetime='2020-04-02 00:00:00 &#43;0000 UTC'>
              April 2, 2020</time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/conjoint-analysis/">Conjoint analysis: modeling judgement to calibrate vulnerability scoring</a>
              </h3>
              
              <time class="published" datetime='2020-03-19 00:00:00 &#43;0000 UTC'>
              March 19, 2020</time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/analytic-hierachy-process/">Using Analytic Hierarchy Process to weight vulnerability scorecard</a>
              </h3>
              
              <time class="published" datetime='2020-02-23 00:00:00 &#43;0000 UTC'>
              February 23, 2020</time>
            </header>
            

          </article>
        
      </div>

      
        <a href=
          
            /post/
          
        class="button">See more</a>
      
    </div>
  </section>

  
  
  


  
  
    <section id="mini-bio">
      <h3>about</h3>
      <p>The humanitarian data analysis professional community shall work towards using a common and open language to build interoperable and transparent analysis standards for joint needs assessments and to obtain maximum value for any data collected.</p>
      <a href="/about" class="button">learn more</a>
    </section>
  

  
  <section id="footer">
    
    <p class="copyright">
      
        © This post is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License，please give source if you wish to quote or reproduce.
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    
    
    
    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="/js/util.js"></script>
      <script src="/js/main.js"></script>
      <script src="/js/backToTop.js"></script>
    
    

    
      
        
      
    
    
    
    <script>hljs.initHighlightingOnLoad();</script>
      <script src="/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


      
          
    
      <script src="/js/collapse.js"></script>
      <script src="/js/dropdown.js"></script>
      <script src="/js/transition.js"></script>
    
    
  </body>
</html>

